<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LOAN MANAGEMENT SYSTEM</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background:#f5f5f5; }
    header { background:#09c9c5; color:#000000; padding:10px 20px; }
    header h1 { margin:0; font-size:30px; }
    main { padding:20px; }
    .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
    select, input, button { padding:6px; margin:4px 0; }
    .card { background:#fff; padding:15px; margin-bottom:15px; border-radius:6px; box-shadow:0 1px 3px rgba(0,0,0,0.15); }
    .hidden { display:none; }
    table { width:100%; border-collapse:collapse; margin-top:8px; }
    th, td { border:1px solid #ddd; padding:6px; font-size:13px; text-align:left; }
    th { background:#e8eaf6; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; font-size:11px; background:#eee; }
    .pill.admin { background:#ffcc80; }
    .pill.lender { background:#81d4fa; }
    .pill.borrower { background:#c5e1a5; }
    .pill.analyst { background:#b39ddb; }
    .stat-grid { display:flex; gap:15px; flex-wrap:wrap; }
    .stat { flex:1 1 150px; background:#fff; padding:10px; border-radius:6px; text-align:center; box-shadow:0 1px 3px rgba(0,0,0,0.1); }
    .stat h3 { margin:4px 0; font-size:14px; color:#555; }
    .stat p { margin:0; font-size:16px; font-weight:bold; }
    .flex { display:flex; gap:15px; flex-wrap:wrap; }
    .flex > div { flex:1 1 260px; }
    .danger { color:#c62828; font-weight:bold; }
  </style>
</head>
<body>
<header>
  <div class="top-bar">
    <h1>LOAN MANAGEMENT SYSTEM</h1>
    <div>
      Role:
      <select id="roleSelect">
        <option value="ADMIN">Admin</option>
        <option value="LENDER">Lender</option>
        <option value="BORROWER">Borrower</option>
        <option value="ANALYST">Financial Analyst</option>
      </select>
      <span id="roleBadge" class="pill admin">Admin</span>
    </div>
  </div>
</header>

<main>
  <section id="adminSection" class="card">
    <h2>Admin Dashboard</h2>
    <p>Oversee platform operations, manage users, and ensure data security.</p>
    <div class="stat-grid">
      <div class="stat">
        <h3>Total Users</h3>
        <p id="statUsers">4</p>
      </div>
      <div class="stat">
        <h3>Total Loans</h3>
        <p id="statLoans">0</p>
      </div>
      <div class="stat">
        <h3>Active Loans</h3>
        <p id="statActiveLoans">0</p>
      </div>
    </div>
  </section>

  <section id="lenderSection" class="card hidden">
    <h2>Lender Panel</h2>
    <p>Create loan offers, track payments, and manage borrower interactions.</p>
    <div class="flex">
      <div>
        <h3>Create New Loan</h3>
        <label>Borrower Name</label><br>
        <input type="text" id="borrowerName" placeholder="e.g. Rahul" /><br>
        <label>Principal (₹)</label><br>
        <input type="number" id="principal" /><br>
        <label>Interest Rate (% per year)</label><br>
        <input type="number" id="rate" step="0.1" value="10" /><br>
        <label>Term (months)</label><br>
        <input type="number" id="months" value="12" /><br>
        <button onclick="createLoan()">Create Loan</button>
        <p id="createMsg"></p>
      </div>
      <div>
        <h3>Your Loans</h3>
        <table id="lenderLoansTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Borrower</th>
              <th>Principal</th>
              <th>Interest</th>
              <th>Total Payable</th>
              <th>Paid</th>
              <th>Balance</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <section id="borrowerSection" class="card hidden">
    <h2>Borrower Panel</h2>
    <p>Apply for loans, track schedules, and manage loan details.</p>

    <h3>Available Loans (assigned to you)</h3>
    <table id="borrowerLoansTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Lender</th>
          <th>Principal</th>
          <th>Total Payable</th>
          <th>Paid</th>
          <th>Balance</th>
          <th>Pay</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h3>Make a Payment</h3>
    <label>Loan ID</label><br>
    <input type="number" id="payLoanId" /><br>
    <label>Amount (₹)</label><br>
    <input type="number" id="payAmount" /><br>
    <button onclick="makePayment()">Submit Payment</button>
    <p id="payMsg"></p>
  </section>

  <section id="analystSection" class="card hidden">
    <h2>Financial Analyst Panel</h2>
    <p>Analyze loan data, assess risks, and view financial metrics.</p>
    <div class="stat-grid">
      <div class="stat">
        <h3>Total Principal</h3>
        <p id="faPrincipal">₹0</p>
      </div>
      <div class="stat">
        <h3>Total Interest</h3>
        <p id="faInterest">₹0</p>
      </div>
      <div class="stat">
        <h3>Total Outstanding</h3>
        <p id="faOutstanding">₹0</p>
      </div>
      <div class="stat">
        <h3>Risk Flagged Loans</h3>
        <p id="faRisk">0</p>
      </div>
    </div>

    <h3>Loan Portfolio</h3>
    <table id="analystLoansTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Lender</th>
          <th>Borrower</th>
          <th>Principal</th>
          <th>Total Payable</th>
          <th>Paid</th>
          <th>Balance</th>
          <th>Risk</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<script>
  let loans = [];
  let nextLoanId = 1;

  function formatMoney(n) {
    return "₹" + Number(n).toFixed(2);
  }

  const roleSelect = document.getElementById("roleSelect");
  const roleBadge  = document.getElementById("roleBadge");

  roleSelect.addEventListener("change", () => {
    const r = roleSelect.value;
    document.getElementById("adminSection").classList.toggle("hidden", r !== "ADMIN");
    document.getElementById("lenderSection").classList.toggle("hidden", r !== "LENDER");
    document.getElementById("borrowerSection").classList.toggle("hidden", r !== "BORROWER");
    document.getElementById("analystSection").classList.toggle("hidden", r !== "ANALYST");

    roleBadge.textContent =
      r === "ADMIN" ? "Admin" :
      r === "LENDER" ? "Lender" :
      r === "BORROWER" ? "Borrower" : "Financial Analyst";

    roleBadge.className = "pill " +
      (r === "ADMIN" ? "admin" :
       r === "LENDER" ? "lender" :
       r === "BORROWER" ? "borrower" : "analyst");

    refreshAllViews();
  });

  function createLoan() {
    const borrowerName = document.getElementById("borrowerName").value.trim();
    const principal = parseFloat(document.getElementById("principal").value);
    const rate = parseFloat(document.getElementById("rate").value);
    const months = parseInt(document.getElementById("months").value, 10);
    const msg = document.getElementById("createMsg");

    if (!borrowerName || isNaN(principal) || isNaN(rate) || isNaN(months)) {
      msg.textContent = "Please fill all fields correctly.";
      msg.className = "danger";
      return;
    }

    const totalInterest = (principal * rate * months) / (100 * 12);
    const totalPayable = principal + totalInterest;

    loans.push({
      id: nextLoanId++,
      lender: "Lender1",
      borrower: borrowerName,
      principal,
      rate,
      months,
      totalInterest,
      totalPayable,
      paid: 0
    });

    msg.textContent = "Loan created successfully!";
    msg.className = "";
    document.getElementById("borrowerName").value = "";
    document.getElementById("principal").value = "";
    document.getElementById("months").value = "12";

    refreshAllViews();
  }

  function makePayment() {
    const id = parseInt(document.getElementById("payLoanId").value, 10);
    const amount = parseFloat(document.getElementById("payAmount").value);
    const msg = document.getElementById("payMsg");

    const loan = loans.find(l => l.id === id);
    if (!loan) {
      msg.textContent = "Loan not found.";
      msg.className = "danger";
      return;
    }
    if (isNaN(amount) || amount <= 0) {
      msg.textContent = "Enter a valid amount.";
      msg.className = "danger";
      return;
    }
    if (amount > loan.totalPayable - loan.paid) {
      msg.textContent = "Amount exceeds outstanding balance.";
      msg.className = "danger";
      return;
    }

    loan.paid += amount;
    msg.textContent = "Payment recorded.";
    msg.className = "";
    document.getElementById("payLoanId").value = "";
    document.getElementById("payAmount").value = "";

    refreshAllViews();
  }

  function refreshAllViews() {
    document.getElementById("statLoans").textContent = loans.length;
    document.getElementById("statActiveLoans").textContent =
      loans.filter(l => l.paid < l.totalPayable).length;

    const lenderBody = document.querySelector("#lenderLoansTable tbody");
    lenderBody.innerHTML = "";
    loans.forEach(l => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${l.id}</td>
        <td>${l.borrower}</td>
        <td>${formatMoney(l.principal)}</td>
        <td>${formatMoney(l.totalInterest)}</td>
        <td>${formatMoney(l.totalPayable)}</td>
        <td>${formatMoney(l.paid)}</td>
        <td>${formatMoney(l.totalPayable - l.paid)}</td>`;
      lenderBody.appendChild(tr);
    });

    const borrowerBody = document.querySelector("#borrowerLoansTable tbody");
    borrowerBody.innerHTML = "";
    loans.forEach(l => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${l.id}</td>
        <td>${l.lender}</td>
        <td>${formatMoney(l.principal)}</td>
        <td>${formatMoney(l.totalPayable)}</td>
        <td>${formatMoney(l.paid)}</td>
        <td>${formatMoney(l.totalPayable - l.paid)}</td>
        <td>${l.totalPayable - l.paid > 0 ? "Pending" : "Cleared"}</td>`;
      borrowerBody.appendChild(tr);
    });

    let totalP = 0, totalI = 0, outstanding = 0, risk = 0;
    const analystBody = document.querySelector("#analystLoansTable tbody");
    analystBody.innerHTML = "";
    loans.forEach(l => {
      totalP += l.principal;
      totalI += l.totalInterest;
      outstanding += (l.totalPayable - l.paid);
      const riskFlag = (l.totalPayable - l.paid) > l.principal * 0.8 ? "HIGH" : "OK";
      if (riskFlag === "HIGH") risk++;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${l.id}</td>
        <td>${l.lender}</td>
        <td>${l.borrower}</td>
        <td>${formatMoney(l.principal)}</td>
        <td>${formatMoney(l.totalPayable)}</td>
        <td>${formatMoney(l.paid)}</td>
        <td>${formatMoney(l.totalPayable - l.paid)}</td>
        <td class="${riskFlag === "HIGH" ? "danger" : ""}">${riskFlag}</td>`;
      analystBody.appendChild(tr);
    });
    document.getElementById("faPrincipal").textContent = formatMoney(totalP);
    document.getElementById("faInterest").textContent = formatMoney(totalI);
    document.getElementById("faOutstanding").textContent = formatMoney(outstanding);
    document.getElementById("faRisk").textContent = risk.toString();
  }

  refreshAllViews();
</script>
</body>
</html>
